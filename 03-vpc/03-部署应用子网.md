该阶段任务 :

        1. 在应用层子网中部署应用服务器实例，并做到弹性伸缩
        2. 为应用层子网中的服务实例部署负载均衡


#### 一.　部署第一台应用层实例 ####

        1. 在子网一，即 10.0.0.0/24 中，创建CVM
        
        2. 部署 iptables，额外允许8080端口
            // 见于 "/01-CVM/01-云机防火墙.md"
            
        3. 代码 + 第三方库( oss2, flask, psycopg2 )
            // 后台代码是python写的，用了flask框架，调用对象存储和postgresql
        
        4. 服务开机启动
            先写个服务启动脚本 webservice.sh
                #!/bin/bash
                cd /home/wuanjun/deepnote/src
                python main.py 0.0.0.0 8080 >/dev/null 2>&1 &
            再配置开机自启，注意不要以root身份来启动服务( 安全一些 )
                vi /etc/rc.d/rc.local
                添加 :
                su - wuanjun -c '/home/wuanjun/webservice.sh'
            
        5. 为该实例创建镜像，以便后面做弹性伸缩
            // 注意，做镜像之前需要关机
            // 注意，上面配置开机启动正是为了增加应用服务器实例的时候可以不用人工启动服务


#### 二.　负载均衡 ####

        1. 创建公网型CLB
            // 本来想用免费的内网型CLB，但是内网型的不支持七层协议，只能支持tcp和udp
        
        2. 创建监听器，前端端口80，后端端口8080
        
        3. 绑定后端应用服务器
            // 建议那些后端服务器，释放掉先前绑定的弹性IP，这样它们就没有外网ip，只能通过CLB来访问


#### 三.　弹性伸缩 ####

        1. 创建AS的启动配置
            // 注意，使用自定义镜像，即在上面创建的应用服务器的镜像
        
        2. 创建AS组
            // 1. 创建失败，后来提交工单后，失败原因是上海二区不支持一代机型了
            //    准确来说是AS的启动配置里的机型选择，如果非要是一代机型，那么AS组的关联子网不能是上海二区里的
            // 2. 解决方案
            //    在原私有网络中新增一个子网( 10.0.2.0/24 )，且是上海一区的
            //    在原postgresql实例的 pg_hba.conf 中增加一行允许该子网访问
            //    在原postgresql实例的 iptables    中增加一行允许该子网访问
        
        3. 创建伸缩策略
            // 有两种模式，一种是定时伸缩，一种是告警触发，这两种不互斥
